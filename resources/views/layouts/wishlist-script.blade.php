<script>
   $(document).ready(function(){let storedAdId=localStorage.getItem('wishlistProductId');if(storedAdId){let wishlistButton=$(`.wishlistButton[data-ad-id='${storedAdId}']`);if(wishlistButton.length){wishlistButton.click()}
localStorage.removeItem('wishlistProductId')}
$('.wishlistButton').off('click').on('click',function(e){e.preventDefault();const wishableId=$(this).data('wishable-id');const wishableType=$(this).data('wishable-type');let isInWishlist=$(this).hasClass('fas');const actionUrl=isInWishlist?'/wishlist/remove':'/wishlist/add';const ajaxMethod=isInWishlist?'DELETE':'POST';$.ajax({url:actionUrl,type:ajaxMethod,data:{_token:$('meta[name="csrf-token"]').attr('content'),wishable_id:wishableId,wishable_type:wishableType,},success:function(response){if(isInWishlist){$(this).removeClass('fas').addClass('far')}else{$(this).removeClass('far').addClass('fas')}
isInWishlist=!isInWishlist;displayToastr(response.success,'success');updateWishlistCount()}.bind(this),error:function(xhr){if(xhr.status===401){localStorage.setItem('wishlistProductId',wishableId);window.location.href=`/login?redirect=${encodeURIComponent(window.location.href)}`}else{let errorMsg=xhr.responseJSON&&xhr.responseJSON.message?xhr.responseJSON.message:"An error occurred";displayToastr(errorMsg,'error')}}})});$('.remove-from-wishlist').off('click').on('click',function(e){e.preventDefault();const wishableId=$(this).data('wishable-id');const wishableType=$(this).data('wishable-type');$.ajax({url:'/wishlist/delete',type:'DELETE',data:{_token:$('meta[name="csrf-token"]').attr('content'),wishable_id:wishableId,wishable_type:wishableType,},success:function(response){displayToastr(response.message,'success');updateWishlistCount();$(this).closest('tr').remove()}.bind(this),error:function(xhr){if(xhr.status===401){window.location.href=`/login?redirect=${encodeURIComponent(window.location.href)}`}else{let errorMsg=xhr.responseJSON&&xhr.responseJSON.message?xhr.responseJSON.message:"An error occurred";displayToastr(errorMsg,'error')}}})});function updateWishlistCount(){$.ajax({url:'{{ route("wishlist.count") }}',type:'GET',success:function(response){$('#wishlistCount').text(response.count)}})}
function displayToastr(message,type){if(type==='success'){toastr.success(message)}else if(type==='error'){toastr.error(message)}else if(type==='warning'){toastr.warning(message)}else if(type==='info'){toastr.info(message)}}})

</script>